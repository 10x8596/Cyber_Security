#!/bin/bash

# Path to encrypted file and decrypted output
ENCRYPTED_FILE="/ctf/crypt_flag/JJ8AQA/admin.bin"
DECRYPTED_FILE="/home/admin2700/decrypted_file.txt"

# Path to the generated passwords file
PASSWORDS_FILE="/home/admin2700/generated_passwords.txt"

# Iterate over each password in the generated list
while IFS= read -r password; do
	echo "Trying password: $password"
	# Attempt to decrypt using OpenSSL
	openssl enc -d -aes-128-cbc -pbkdf2 -pass pass:"$password" -iter 10000 -salt -in "$ENCRYPTED_FILE" -out "$DECRYPTED_FILE" 2>/dev/null

	# Check if decryption was successful
	if [ $? -eq 0 ]; then
		echo "Password $password worked, checking contents..."
		# Check if decrypted file contains flag
		if grep -q "flag{" "$DECRYPTED_FILE"; then
			echo "Success. Password is: $password"
			cat "$DECRYPTED_FILE"
			exit 0
		else
			echo "Password correct, but no flag found in file. Continuing"
		fi
	fi
done < "$PASSWORDS_FILE"

echo "Failed to crack the password"
