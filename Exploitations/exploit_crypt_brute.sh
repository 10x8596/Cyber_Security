#!/bin/bash

# Path to encrypted file and decrypted output
ENCRYPTED_FILE="/ctf/crypt_flag/JJ8AQA/admin.bin"
DECRYPTED_FILE="/home/admin2700/decrypted_file.txt"

# Path to the generated passwords file
PASSWORD_FILE="/home/admin2700/masks_generated_passwords.txt"

# Generate passwords using Hashcat's mask attack mode
while IFS= read -r password; do
	echo "Trying password: $password"
	# Attempt to decrypt using OpenSSL
	if openssl enc -d -aes-128-cbc -pbkdf2 -pass pass:"$password" -iter 10000 -salt -in "$ENCRYPTED_FILE" -out "$DECRYPTED_FILE" 2>/dev/null; then
		# Check if decryption was successful
		echo "Password $password worked, checking contents..."
		# Check if decrypted file contains flag
		if grep -q "flag" "$DECRYPTED_FILE"; then
			echo "Success. Password is: $password"
			cat "$DECRYPTED_FILE"
			exit 0
		else
			echo "Password correct, but no flag found. Continuing..."
		fi
	fi
done < "$PASSWORD_FILE"

echo "Failed to crack the password"
